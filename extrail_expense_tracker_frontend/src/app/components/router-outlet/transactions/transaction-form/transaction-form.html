<!-- src/app/components/transactions/transaction-form/transaction-form.html -->
<!-- Replace the outer div in transaction-form.component.html -->
<div
  class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/40 backdrop-blur-md"
  (click)="onBackgroundClick($event)"
>
  <div
    class="bg-white rounded-2xl shadow-2xl w-full max-w-md transform transition-all"
    (click)="$event.stopPropagation()"
  >
    <!-- Header -->
    <div
      class="px-6 py-4 border-b border-gray-200"
      [class.bg-cyan-50]="modalColor === 'cyan'"
      [class.bg-rose-50]="modalColor === 'rose'"
      [class.bg-purple-50]="modalColor === 'purple'"
    >
      <div class="flex items-center justify-between">
        <h3 class="text-xl font-bold text-gray-900">{{ modalTitle }}</h3>
        <button (click)="onClose()" class="p-2 hover:bg-white rounded-lg transition-colors">
          <span class="material-icons-outlined text-gray-600">close</span>
        </button>
      </div>
    </div>

    <!-- Transfer Form -->
    <form
      *ngIf="type === 'transfer'"
      [formGroup]="transferForm"
      (ngSubmit)="onSubmit()"
      class="p-6 space-y-4"
    >
      <!-- From Account -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">From Account</label>
        <select
          formControlName="fromAccountId"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
        >
          <option value="">Select account</option>
          <option *ngFor="let acc of accounts" [value]="acc.accountId">
            {{ acc.accountName }} - ${{ acc.accountBalance.toLocaleString() }}
          </option>
        </select>
        <div
          *ngIf="
            transferForm.get('fromAccountId')?.invalid && transferForm.get('fromAccountId')?.touched
          "
          class="text-red-600 text-sm mt-1"
        >
          Please select an account
        </div>
      </div>

      <!-- To Account -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">To Account</label>
        <select
          formControlName="toAccountId"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
        >
          <option value="">Select account</option>
          <option *ngFor="let acc of accounts" [value]="acc.accountId">
            {{ acc.accountName }} - ${{ acc.accountBalance.toLocaleString() }}
          </option>
        </select>
        <div
          *ngIf="
            transferForm.get('toAccountId')?.invalid && transferForm.get('toAccountId')?.touched
          "
          class="text-red-600 text-sm mt-1"
        >
          Please select an account
        </div>
      </div>

      <!-- Amount -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Amount</label>
        <input
          type="number"
          formControlName="amount"
          step="0.01"
          min="0"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
          placeholder="0.00"
        />
        <div
          *ngIf="transferForm.get('amount')?.invalid && transferForm.get('amount')?.touched"
          class="text-red-600 text-sm mt-1"
        >
          Amount must be greater than 0
        </div>
      </div>

      <!-- Date -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
        <input
          type="datetime-local"
          formControlName="date"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
        />
        <div
          *ngIf="transferForm.get('date')?.invalid && transferForm.get('date')?.touched"
          class="text-red-600 text-sm mt-1"
        >
          Date is required
        </div>
      </div>

      <!-- Note -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Note (Optional)</label>
        <textarea
          formControlName="note"
          rows="3"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
          placeholder="Add a note..."
        ></textarea>
      </div>

      <!-- Error Message -->
      <div *ngIf="errorMessage" class="bg-red-100 text-red-700 px-4 py-3 rounded-lg text-sm">
        {{ errorMessage }}
      </div>

      <!-- Actions -->
      <div class="flex gap-3 pt-4">
        <button
          type="button"
          (click)="onClose()"
          class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
        >
          Cancel
        </button>
        <button
          type="submit"
          [disabled]="isSubmitting"
          class="flex-1 px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50"
        >
          {{ isSubmitting ? 'Transferring...' : 'Transfer' }}
        </button>
      </div>
    </form>

    <!-- Income/Expense Form -->
    <form
      *ngIf="type !== 'transfer'"
      [formGroup]="transactionForm"
      (ngSubmit)="onSubmit()"
      class="p-6 space-y-4"
    >
      <!-- Amount -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Amount</label>
        <input
          type="number"
          formControlName="amount"
          step="0.01"
          min="0"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent"
          [class.focus:ring-cyan-500]="type === 'income'"
          [class.focus:ring-rose-500]="type === 'expense'"
          placeholder="0.00"
        />
        <div
          *ngIf="transactionForm.get('amount')?.invalid && transactionForm.get('amount')?.touched"
          class="text-red-600 text-sm mt-1"
        >
          Amount must be greater than 0
        </div>
      </div>

      <!-- Date -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
        <input
          type="datetime-local"
          formControlName="date"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent"
          [class.focus:ring-cyan-500]="type === 'income'"
          [class.focus:ring-rose-500]="type === 'expense'"
        />
        <div
          *ngIf="transactionForm.get('date')?.invalid && transactionForm.get('date')?.touched"
          class="text-red-600 text-sm mt-1"
        >
          Date is required
        </div>
      </div>

      <!-- Account -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Account</label>
        <select
          formControlName="accountId"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent"
          [class.focus:ring-cyan-500]="type === 'income'"
          [class.focus:ring-rose-500]="type === 'expense'"
        >
          <option value="">Select account</option>
          <option *ngFor="let acc of accounts" [value]="acc.accountId">
            {{ acc.accountName }} - ${{ acc.accountBalance.toLocaleString() }}
          </option>
        </select>
        <div
          *ngIf="
            transactionForm.get('accountId')?.invalid && transactionForm.get('accountId')?.touched
          "
          class="text-red-600 text-sm mt-1"
        >
          Please select an account
        </div>
      </div>

      <!-- transaction-form.component.html - Replace Category section -->
      <!-- Category -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
        <select
          formControlName="categoryId"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent"
          [class.focus:ring-cyan-500]="type === 'income'"
          [class.focus:ring-rose-500]="type === 'expense'"
        >
          <option value="">Select category</option>
          <!-- Use trackBy to prevent duplicates -->
          <option *ngFor="let cat of categories; trackBy: trackByCategory" [value]="cat.categoryId">
            {{ cat.categoryName }}
          </option>
        </select>
        <div
          *ngIf="
            transactionForm.get('categoryId')?.invalid && transactionForm.get('categoryId')?.touched
          "
          class="text-red-600 text-sm mt-1"
        >
          Please select a category
        </div>
      </div>

      <!-- Description -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
        <textarea
          formControlName="description"
          rows="3"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent"
          [class.focus:ring-cyan-500]="type === 'income'"
          [class.focus:ring-rose-500]="type === 'expense'"
          placeholder="Add a description..."
        ></textarea>
        <div
          *ngIf="
            transactionForm.get('description')?.invalid &&
            transactionForm.get('description')?.touched
          "
          class="text-red-600 text-sm mt-1"
        >
          <p *ngIf="transactionForm.get('description')?.errors?.['required']">
            Description is required
          </p>
          <p *ngIf="transactionForm.get('description')?.errors?.['maxlength']">
            Maximum 255 characters
          </p>
        </div>
      </div>

      <!-- Error Message -->
      <div *ngIf="errorMessage" class="bg-red-100 text-red-700 px-4 py-3 rounded-lg text-sm">
        {{ errorMessage }}
      </div>

      <!-- Actions -->
      <div class="flex gap-3 pt-4">
        <button
          type="button"
          (click)="onClose()"
          class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
        >
          Cancel
        </button>
        <button
          type="submit"
          [disabled]="isSubmitting"
          class="flex-1 px-4 py-3 text-white rounded-lg transition-colors disabled:opacity-50"
          [class.bg-cyan-600]="type === 'income'"
          [class.hover:bg-cyan-700]="type === 'income'"
          [class.bg-rose-600]="type === 'expense'"
          [class.hover:bg-rose-700]="type === 'expense'"
        >
          {{ isSubmitting ? 'Saving...' : transaction ? 'Update' : 'Save' }}
        </button>
      </div>
    </form>
  </div>
</div>
